<!DOCTYPE html>
{% extends "base.html" %}

{% block css_place %}

.trade_log{
    height:550px;
    width: 100%;
    font-size: 12px;
    border-bottom: 1px solid grey;
}

thead, tbody tr {
    display:table;
    width:100%;
    table-layout:fixed;
    line-height: 5px;
    height:5px;
    text-align:center;

}


tbody {
    display:block;
    height:500px;
    overflow:auto;
    background: white;
}

h5{
    margin:5px;
}

.menu_bar{
    height:50px;
    margin:auto;
    border-bottom: 1px solid grey;
}

.chart_area{
    margin:auto;
    height:250px;
    border-bottom: 1px solid grey;
}

{% endblock %}

{% block my_scripts %}

{% endblock %}
    {% block entry_form %}
    <div class="row">
        <form style="width:100%">
            <div class="form-group" style="width:100%; padding-left:5px; padding-right:5px;">
                <div style="display:flex;">
                    <h5 class="nav-link link_color font-weight-bold">Comments</h5>
                    <button type="submit" class="btn btn-primary btn-sm" style="height:30px; width:60px; margin:10px;">Save</button>
                </div>

                <textarea class="form-control" rows="3" style="width:100%; height:235px;"></textarea>
            </div>
        </form>
    </div>
    <h5 class="nav-link link_color font-weight-bold">
        Trade Log
    </h5>
    <div class="trade_log">
        <table class="table">
          <thead>
            <tr>
                <th>Robot</th>
                <th>Security</th>
                <th>Action</th>
                <th>Quantity</th>
            </tr>
          </thead>
          <tbody>
            <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
            <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          <tr>
                <td>test</td>
                <td>EUR_USD</td>
                <td>BUY</td>
                <td>10000</td>
            </tr>
          </tbody>
        </table>
    </div>
    {% endblock %}

    {% block main_block%}
    <div class="row menu_bar">
        <!--Form for submiting robot results-->
        <div style="height:50px; width:25%;  border-right: 1px solid grey;">
            <!--Form to load all accounts-->
            <form class="form-inline input-sm" style="padding:5px;" action="{% url 'make_default' %}" method="POST">
                {% csrf_token %}
                <label class="col-form-label">Accounts</label>
                <div class="col-auto">
                    <select class="form-control input-sm" style="height:30px; width:150px;" name="account">
                        {% for account in accounts %}
                        <option >{{account.account_number}}</option>
                        {% endfor %}
                    </select>
                </div>
                <button type="submit" class="btn btn-primary btn-sm" style="height:30px; width:60px;">Default</button>
            </form>
        </div>
        <div  style="height:50px; width:75%;">
            <form class="form-inline" style="padding:5px;" action="{% url 'get_results' %}" method="POST">
                {% csrf_token %}
                    <label class="col-form-label">Trade</label>
                    <div class="col-auto">
                        <select class="form-control" style="height:30px;" name="side">
                            <option >BUY</option>
                            <option>SELL</option>
                            <option selected>ALL</option>
                        </select>
                    </div>

                    <label class="col-form-label">Robot</label>
                    <div class="col-auto">
                        <select class="form-control" style="height:30px; width:80px;" name="robot_name">
                            {% for robot in robots %}
                            <option>{{robot}}</option>
                            {% endfor %}
                        </select>
                    </div>

                    <label for="start">Start Date:</label>
                    <div class="col-auto">
                        <input class="form-control" style="height:30px;" type="date" id="start" name="start_date" value="{{ beg_month }}" min="2020-01-01">
                    </div>

                    <label for="end">End Date:</label>
                    <div class="col-auto">
                        <input class="form-control" style="height:30px;" type="date" id="end" name="end_date" value="{{ today }}" min="2020-01-01">
                    </div>

                <button type="submit" class="btn btn-primary btn-sm" style="height:30px;">Submit</button>
            </form>
        </div>
    </div>

    <div class="row chart_area">
        <div class="col" style="width:50%;">
            <canvas id="line_chart" width="50%" height="20">
            <script>
                var ctx = document.getElementById('line_chart').getContext('2d');
                var chart = new Chart(ctx, {
                // The type of chart we want to create
                type: 'bar',

                // The data for our dataset
                data: {
                    labels: {{ pnl_label }},
                    datasets: [{
                        label: 'P&L by Trades',
                        backgroundColor: '#49B0C2',
                        borderColor: '#19393D',
                        data: {{ pnls }}
                    }]
                },

                // Configuration options go here
                options: {}
                });
            </script>
            </canvas>
        </div>
        <div class="col" style="width:50%;">
            <canvas id="line_chart_2" width="50%" height="20">

            <script>
                var ctx = document.getElementById('line_chart_2').getContext('2d');
                var chart = new Chart(ctx, {
                // The type of chart we want to create
                type: 'line',

                // The data for our dataset
                data: {
                    labels: {{ pnl_label }},
                    datasets: [{
                        label: 'Cumulative P&L',
                        backgroundColor: '#49B0C2',
                        borderColor: '#19393D',
                        data: {{ cum_pnl }}
                    }]
                },

                // Configuration options go here
                options: {}
                });
            </script>
            </canvas>
        </div>
    </div>

    <div class="row chart_area">
        <div class="col" style="width:50%;">
            <canvas id="bar_chart_2" width="50%" height="20">
            <script>
                var ctx = document.getElementById('bar_chart_2').getContext('2d');
                var chart = new Chart(ctx, {
                // The type of chart we want to create
                type: 'line',

                // The data for our dataset
                data: {

                    labels: [],
                    datasets: [{
                        label: 'P&L by Trades',
                        backgroundColor: '#49B0C2',
                        borderColor: '#19393D',
                        data: []
                    }]
                },

                // Configuration options go here
                options: {}
                });
            </script>
            </canvas>
        </div>
        <div class="col" style="width:50%;">
            <canvas id="line_chart_4" width="50%" height="20">

            <script>
                var ctx = document.getElementById('line_chart_4').getContext('2d');
                var chart = new Chart(ctx, {
                // The type of chart we want to create
                type: 'line',

                // The data for our dataset
                data: {
                    labels: {{ balance_label }},
                    datasets: [{
                        label: 'Balance History',
                        backgroundColor: '#49B0C2',
                        borderColor: '#19393D',
                        data: {{ balance }}
                    }]
                },

                // Configuration options go here
                options: {}
                });
            </script>
            </canvas>
        </div>
    </div>

    <!--Open trades Table-->
    <div class="row" style="height:350px; margin-right: 0px; margin-left:0px;">
        <h5 class="nav-link link_color font-weight-bold">
        Open Trades
        </h5>
        <div class="trade_log" style="height:300px;">
            <table class="table trade_table">
          <thead>
            <tr class="align-middle">
                <th>Robot</th>
                <th>Security</th>
                <th>Action</th>
                <th>Quantity</th>
                <th>Open Price</th>
                <th>Time Frame</th>
                <th>P&L</th>
                <th>P&L %</th>
                <th></th>
            </tr>
          </thead>
          <tbody style="height:250px;">
          {% for trade in open_trades %}
            <tr class="align-middle">
                <td class="align-middle">{{trade.robot}}</td>
                <td class="align-middle">{{trade.security}}</td>
                <td class="align-middle">{{trade.side}}</td>
                <td class="align-middle">{{trade.quantity}}</td>
                <td class="align-middle">{{trade.open_price}}</td>
                <td class="align-middle">{{trade.time_frame}}</td>
                <td class="align-middle">30.23</td>
                <td class="align-middle">2.4</td>
                <td class="align-middle"><button class="btn btn-primary btn-sm">Close</button></td>
            </tr>
          {% endfor %}
          </tbody>
        </table>
        </div>
    </div>

    <div class="row">
        <form action="{% url 'test_execution' %}" method="POST">
            <input class="btn btn-primary btn-sm" type="submit", name="button" value="Test Open Trade Execution"><br>
        </form>
        <form action="{% url 'test_close_execution' %}" method="POST">
            <input class="btn btn-primary btn-sm" type="submit", name="button" value="Test Close Trade Execution"><br>
        </form>
    </div>
    {% endblock %}
    <script>if ({{ message }} == "empty"){
        alert("There is no record for this period!");
        }
    </script>
